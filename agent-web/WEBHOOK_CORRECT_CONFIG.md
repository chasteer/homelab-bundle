# 🔧 Правильная конфигурация вебхука Uptime Kuma

## 🎯 Проблема решена!

**Uptime Kuma не мог отправить уведомления, потому что использовал внешний IP `192.168.1.200:8000`, а должен использовать внутренний IP Docker сети.**

## ✅ Правильная конфигурация

### В Uptime Kuma настройте вебхук:

**URL вебхука:** `http://172.20.0.4:8000/api/webhook/uptime-kuma`

**НЕ используйте:** `http://192.168.1.200:8000/api/webhook/uptime-kuma`

## 🔍 Почему это происходит?

1. **Uptime Kuma** находится в Docker сети `homelab` с IP `172.20.0.8`
2. **Agent** находится в той же сети с IP `172.20.0.4`
3. **Внешний IP** `192.168.1.200` доступен только с хоста, не из контейнеров
4. **Внутренние IP** `172.20.0.x` доступны между контейнерами в одной сети

## 📋 Пошаговая настройка

### Шаг 1: Откройте Uptime Kuma
```
http://192.168.1.200:3001
```

### Шаг 2: Создайте уведомление
1. Settings → Notifications
2. Add New Notification
3. Type: Webhook

### Шаг 3: Настройте параметры
- **Name:** `Homelab Agent Webhook`
- **URL:** `http://172.20.0.4:8000/api/webhook/uptime-kuma` ⭐
- **Method:** `POST`
- **Content Type:** `application/json`
- **Events:** все (up, down, paused, maintenance)

### Шаг 4: Тестирование
1. Нажмите **"Test"**
2. Должно появиться сообщение об успешной отправке
3. Нажмите **"Save"**

## 🔍 Проверка работы

### Тест 1: Остановка сервиса
```bash
sudo docker compose -f services/docker-compose.yml stop torrserver
```

### Тест 2: Проверка логов агента
```bash
sudo docker logs homelab-agent | grep -i "webhook\|uptime" | tail -5
```

**Ожидаемый результат:**
```
🚨 Получено уведомление от Uptime Kuma: TorrServer - down
```

## 🚨 Альтернативные решения

### Вариант 1: Использовать внутренний IP (рекомендуется)
```
URL: http://172.20.0.4:8000/api/webhook/uptime-kuma
```

### Вариант 2: Использовать имя контейнера
```
URL: http://homelab-agent:8000/api/webhook/uptime-kuma
```

### Вариант 3: Использовать имя сервиса
```
URL: http://agent:8000/api/webhook/uptime-kuma
```

## 📊 Сетевая схема

```
┌─────────────────┐    ┌─────────────────┐
│   Uptime Kuma   │    │   Homelab Agent │
│   172.20.0.8    │◄──►│   172.20.0.4    │
│   (uptime-kuma) │    │  (homelab-agent)│
└─────────────────┘    └─────────────────┘
         │                       │
         └───────────────────────┘
                    │
              Docker Network
              "homelab"
```

## 🎯 Результат

После правильной настройки:
- ✅ Uptime Kuma сможет отправлять уведомления
- ✅ Агент будет получать все события
- ✅ Мониторинг будет работать в реальном времени
- ✅ Логи будут показывать все уведомления

---

**Используйте внутренний IP `172.20.0.4:8000` для вебхука!** 🚀
